<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sanic the Porcupine</title>
    <style>
        body {
            background: #000;
            margin: 0;
            overflow: hidden;
        }
        canvas {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            width: 100vw;
            height: 100vh;
            display: block;
        }
    </style>
</head>
<body>
<canvas id="game" width="320" height="180"></canvas>

<script>
// =========================
// BASIC GAME SETUP
// =========================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Pixel scale
ctx.imageSmoothingEnabled = false;

// Game constants
const GRAVITY = 0.4;
const JUMP_FORCE = -7;
const MOVE_SPEED = 2;

let level = 1;
let ringsCollected = 0;

// =========================
// PLAYER
// =========================
const player = {
    x: 20,
    y: 0,
    w: 12,
    h: 16,
    vy: 0,
    grounded: false
};

// =========================
// ENEMIES & RINGS
// =========================
let enemies = [];
let rings = [];

function spawnLevel(n) {
    enemies = [];
    rings = [];

    // Spawn enemies
    for (let i = 0; i < n + 2; i++) {
        enemies.push({
            x: 80 + i * 40,
            y: 140,
            w: 14,
            h: 14,
            alive: true
        });
    }

    // Spawn rings
    for (let i = 0; i < n + 3; i++) {
        rings.push({
            x: 60 + i * 30,
            y: 100,
            w: 8,
            h: 8,
            collected: false
        });
    }
}

spawnLevel(level);

// =========================
// INPUT
// =========================
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// =========================
// GAME LOOP
// =========================
function update() {
    // Movement
    if (keys["ArrowRight"]) player.x += MOVE_SPEED;
    if (keys["ArrowLeft"]) player.x -= MOVE_SPEED;

    // Jump
    if (keys[" "] && player.grounded) {
        player.vy = JUMP_FORCE;
        player.grounded = false;
    }

    // Gravity
    player.vy += GRAVITY;
    player.y += player.vy;

    // Ground collision
    if (player.y + player.h >= 160) {
        player.y = 160 - player.h;
        player.vy = 0;
        player.grounded = true;
    }

    // Enemy collision
    enemies.forEach(e => {
        if (!e.alive) return;

        if (rectCollision(player, e)) {
            // Jump kill
            if (player.vy > 0) {
                e.alive = false;
                player.vy = JUMP_FORCE * 0.7;
            } else {
                // Player hit (reset level)
                resetLevel();
            }
        }
    });

    // Ring collection
    rings.forEach(r => {
        if (!r.collected && rectCollision(player, r)) {
            r.collected = true;
            ringsCollected++;
        }
    });

    // Level complete
    if (enemies.every(e => !e.alive)) {
        level++;
        if (level > 10) level = 1;
        spawnLevel(level);
    }
}

function resetLevel() {
    player.x = 20;
    player.y = 0;
    player.vy = 0;
    spawnLevel(level);
}

// =========================
// RENDER
// =========================
function draw() {
    ctx.fillStyle = "#202040";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Ground
    ctx.fillStyle = "#303030";
    ctx.fillRect(0, 160, canvas.width, 20);

    // Player (blue porcupine)
    ctx.fillStyle = "#2aa9ff";
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // Enemies (red blobs)
    enemies.forEach(e => {
        if (e.alive) {
            ctx.fillStyle = "#ff4444";
            ctx.fillRect(e.x, e.y, e.w, e.h);
        }
    });

    // Rings (yellow)
    rings.forEach(r => {
        if (!r.collected) {
            ctx.fillStyle = "#ffdd00";
            ctx.fillRect(r.x, r.y, r.w, r.h);
        }
    });

    // HUD
    ctx.fillStyle = "#ffffff";
    ctx.fillText("Rings: " + ringsCollected, 10, 10);
    ctx.fillText("Level: " + level, 10, 20);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();

// =========================
// COLLISION
// =========================
function rectCollision(a, b) {
    return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
    );
}
</script>
</body>
</html>
